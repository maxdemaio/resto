---
import { getRelativeLocaleUrl } from 'astro:i18n';
import { getLangFromUrl, useTranslations } from "../i18n/utils";

// defaultLocale is "en"
const frUrl = getRelativeLocaleUrl("fr", "");
const enUrl = getRelativeLocaleUrl("en", "");

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<style>
  #mobile-nav-view {
    transform: translateX(-100%); /* start all the way left */
    animation-play-state: paused;
    animation-fill-mode: forwards;
    animation-timing-function: ease-in-out;
    animation-duration: 300ms;
    animation-name: slide-lr;
    height: 100%;
    width: 100%;
    position: fixed;
    z-index: 40;
    inset: 0;
    color: white;
    background-color: #974319;
    padding: 1rem 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 5rem;
  }

  /* start all the way left and move right */
  @keyframes slide-lr {
    0% {
      transform: translateX(-100%);
    }

    100% {
      transform: translateX(0%);
    }
  }

  @keyframes slide-rl {
    0% {
      transform: translateX(0%);
    }

    100% {
      transform: translateX(-100%);
    }
  }
</style>
<nav
  class="sticky top-0 z-30 bg-[#DED4C8] text-[#974319] md:hidden flex items-center justify-between p-4"
>
  <button aria-label="Menu button" id="menu-button">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="32"
      height="32"
      viewBox="0 0 32 32"
      ><path
        fill="none"
        stroke="currentColor"
        strokeLinecap="round"
        stroke-linejoin="round"
        strokeWidth="2"
        d="M5 8h22M5 16h22M5 24h22"></path></svg
    >
  </button>
  <a
    href="#"
    class="flex items-center justify-center gap-2 text-lg font-mantra"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="32"
      height="32"
      viewBox="0 0 24 24"
      ><path
        fill="currentColor"
        fill-rule="evenodd"
        d="M5.624 4.424C3.965 5.182 2.75 6.986 2.75 9.137c0 2.197.9 3.891 2.188 5.343c1.063 1.196 2.349 2.188 3.603 3.154c.298.23.594.459.885.688c.526.415.995.778 1.448 1.043c.207.12.395.212.568.275l.727-2.91l-1.7-1.7a.75.75 0 0 1-.038-1.018l2.466-2.878l-2.833-2.024a.75.75 0 0 1-.235-.946l1.256-2.51c-1.943-1.792-3.946-1.922-5.46-1.23ZM12.62 5.94l-1.162 2.322l2.979 2.128a.75.75 0 0 1 .133 1.098l-2.548 2.973l1.51 1.509a.75.75 0 0 1 .197.712l-.683 2.73l.081-.047c.453-.265.922-.628 1.448-1.043c.29-.23.587-.458.885-.688c1.254-.966 2.54-1.958 3.603-3.154c1.289-1.452 2.188-3.146 2.188-5.343c0-2.15-1.215-3.955-2.874-4.713c-1.592-.727-3.723-.546-5.757 1.516ZM12 4.46C9.688 2.39 7.099 2.1 5 3.059C2.786 4.074 1.25 6.426 1.25 9.138c0 2.665 1.11 4.699 2.567 6.339c1.166 1.313 2.593 2.412 3.854 3.382c.286.22.563.434.826.642c.513.404 1.063.834 1.62 1.16c.557.325 1.193.59 1.883.59s1.326-.265 1.883-.59c.558-.326 1.107-.756 1.62-1.16a78.6 78.6 0 0 1 .826-.642c1.26-.97 2.688-2.07 3.854-3.382c1.457-1.64 2.567-3.674 2.567-6.339c0-2.712-1.535-5.064-3.75-6.077c-2.099-.96-4.688-.67-7 1.399Z"
        clip-rule="evenodd"></path></svg
    >
    <span>RESTO</span></a
  >
  <div class="w-10">
    <a href={lang === "en" ? frUrl : enUrl} class="underline">
      {t("nav.langmob")}
    </a>
  </div>
</nav>
<nav id="mobile-nav-view">
  <div class="flex justify-between">
    <div></div>
    <button aria-label="Close button" id="close-button">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="32"
        height="32"
        viewBox="0 0 32 32"
        ><path
          fill="none"
          stroke="currentColor"
          strokeLinecap="round"
          stroke-linejoin="round"
          strokeWidth="2"
          d="M9 23L23 9m0 14L9 9"></path></svg
      >
    </button>
  </div>
  <div class="flex flex-col gap-6">
    <!--Note: after clicking, we should transition the mobile-nav-view away -->
    <a href="#about-resto" class="mobile-nav-view-button text-3xl">ABOUT</a>
    <a href="#menus-dropdown" class="mobile-nav-view-button text-3xl">MENUS</a>
    <a href="#contact" class="mobile-nav-view-button text-3xl">CONTACT</a>
    <a href="#" class="mobile-nav-view-button text-3xl">INSTAGRAM</a>
    <a href="#" class="mobile-nav-view-button text-3xl">FACEBOOK</a>
  </div>
</nav>

<script>
  const menuButton: HTMLElement | null = document.getElementById("menu-button");
  const mobileNavView: HTMLElement | null =
    document.getElementById("mobile-nav-view");
  const closeButton: HTMLElement | null =
    document.getElementById("close-button");
  const mobileNavViewButtons: HTMLCollectionOf<Element> | null =
    document.getElementsByClassName("mobile-nav-view-button");

  if (menuButton && mobileNavView) {
    menuButton.addEventListener("click", function () {
      mobileNavView.style.animationName = "slide-lr";
      mobileNavView.style.animationPlayState = "running";
      document.body.style.overflow = "hidden";
    });
  }

  if (closeButton && mobileNavView && mobileNavViewButtons) {
    closeButton.addEventListener("click", function () {
      mobileNavView.style.animationName = "slide-rl";
      document.body.style.overflow = "auto";
    });

    for (const button of mobileNavViewButtons) {
      button.addEventListener("click", function () {
        mobileNavView.style.animationName = "slide-rl";
        document.body.style.overflow = "auto";
      });
    }
  }
</script>
